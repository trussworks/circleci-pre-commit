#!/usr/bin/env bash
set -x -eu -o pipefail

shopt -s extglob
for tag in $CIRCLE_SHA1 ${CIRCLE_BRANCH//+([^A-Za-z0-9-.])/-}; do
    # latest
    docker tag  trussworks/circleci-pre-commit trussworks/circleci-pre-commit:"$tag"
    docker push trussworks/circleci-pre-commit:"$tag"
done

# default tags
if [[ $CIRCLE_BRANCH = master ]]; then
    docker push trussworks/circleci-pre-commit
fi
